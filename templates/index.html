<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Pad - Task Management Dashboard</title>

    <!-- Core Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <!-- Modern Fonts - x.ai Style -->
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Text:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        :root {
            /* x.ai Professional Color Palette */
            --primary: #007AFF;
            --primary-dark: #0056CC;
            --primary-light: #4DA3FF;
            --secondary: #6B7280;
            --success: #34C759;
            --warning: #FF9500;
            --danger: #FF3B30;
            --info: #5AC8FA;

            /* Professional Neutral Colors */
            --gray-50: #FAFAFA;
            --gray-100: #F2F2F7;
            --gray-200: #E5E5EA;
            --gray-300: #D1D1D6;
            --gray-400: #C7C7CC;
            --gray-500: #AEAEB2;
            --gray-600: #8E8E93;
            --gray-700: #636366;
            --gray-800: #48484A;
            --gray-900: #1C1C1E;

            /* Clean Spacing & Layout */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;

            /* Subtle Shadows - x.ai Style */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.03);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.04), 0 1px 2px 0 rgba(0, 0, 0, 0.03);
            --shadow-md: 0 2px 8px 0 rgba(0, 0, 0, 0.04), 0 2px 4px 0 rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 4px 16px 0 rgba(0, 0, 0, 0.05), 0 2px 8px 0 rgba(0, 0, 0, 0.03);
            --shadow-xl: 0 8px 32px 0 rgba(0, 0, 0, 0.06), 0 4px 16px 0 rgba(0, 0, 0, 0.04);

            /* Clean White Background Theme */
            --bg-primary: #FFFFFF;
            --bg-secondary: #FAFAFA;
            --bg-tertiary: #F2F2F7;
            --bg-navbar: rgba(255, 255, 255, 0.95);
            --bg-card: rgba(255, 255, 255, 0.98);
            --text-primary: #1C1C1E;
            --text-secondary: #636366;
            --text-muted: #8E8E93;
            --border-primary: rgba(142, 142, 147, 0.12);
            --border-secondary: rgba(255, 255, 255, 0.8);
            --shadow-light: rgba(0, 0, 0, 0.02);
            --shadow-medium: rgba(0, 0, 0, 0.04);
            --shadow-heavy: rgba(0, 0, 0, 0.06);
        }


        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

      body {
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* x.ai Typography Hierarchy */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-weight: 600;
            line-height: 1.2;
            letter-spacing: -0.025em;
            margin-bottom: 0.5rem;
        }

        h1 { font-size: 2.25rem; font-weight: 700; }
        h2 { font-size: 1.875rem; font-weight: 600; }
        h3 { font-size: 1.5rem; font-weight: 600; }
        h4 { font-size: 1.25rem; font-weight: 600; }
        h5 { font-size: 1.125rem; font-weight: 500; }
        h6 { font-size: 1rem; font-weight: 500; }

        /* x.ai Navigation - Clean & Professional */
        .navbar {
            background: var(--bg-navbar);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-primary);
            box-shadow: 0 1px 3px 0 var(--shadow-light);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1050;
        }

        .navbar-brand {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: -0.025em;
        }

        .navbar-brand:hover {
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }

        /* ProgressPad Logo and Brand Styles */
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(29, 78, 216, 0.1));
            transition: all 0.3s ease;
        }

        .navbar-brand:hover .logo-container {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(29, 78, 216, 0.2));
            transform: scale(1.05);
        }

        .brand-text {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .brand-name {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .brand-subtitle {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 500;
            margin-top: -2px;
        }

        .navbar-brand:hover .brand-name {
            color: var(--primary);
        }

        /* Modern Navigation Styles */
        .modern-nav {
            margin-left: auto;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.875rem;
            border-radius: var(--radius-md);
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            background: none;
            cursor: pointer;
            position: relative;
            min-height: 36px;
        }

        .nav-link:hover {
            color: var(--primary);
            background-color: rgba(0, 122, 255, 0.06);
            border-color: rgba(0, 122, 255, 0.12);
        }

        .nav-link.active {
            color: var(--primary);
            background-color: rgba(0, 122, 255, 0.08);
            border-color: rgba(0, 122, 255, 0.16);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 2px;
            background-color: var(--primary);
            border-radius: 1px;
        }

        .nav-link i {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .nav-link:hover i {
            opacity: 1;
        }

        .nav-link span {
            font-size: 0.875rem;
        }

        .nav-divider {
            width: 1px;
            height: 20px;
            background-color: var(--border-color);
            margin: 0 0.5rem;
        }

        .admin-link {
            color: var(--warning) !important;
        }

        .admin-link:hover {
            background-color: rgba(245, 158, 11, 0.1) !important;
        }

        /* Navigation buttons styling - exclude functional buttons */
        .modern-nav .btn:not(#quickAddBtn):not(#filterToggleBtn) {
            background: none;
            border: 1px solid transparent;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.875rem;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 0.5rem 0.875rem;
            border-radius: var(--radius-md);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-height: 36px;
            margin: 0;
        }

        .modern-nav .btn:not(#quickAddBtn):not(#filterToggleBtn):hover {
            color: var(--primary);
            background-color: rgba(0, 122, 255, 0.06);
            border-color: rgba(0, 122, 255, 0.12);
        }

        .modern-nav .btn:not(#quickAddBtn):not(#filterToggleBtn):focus {
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        /* Specific styling for functional buttons */
        .modern-nav #quickAddBtn, .modern-nav #filterToggleBtn {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            color: var(--text-primary);
        }

        .modern-nav #quickAddBtn:hover, .modern-nav #filterToggleBtn:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Responsive navbar adjustments */
        @media (max-width: 1200px) {
            .navbar .d-flex.align-items-center.gap-2.me-3 {
                gap: 0.25rem !important;
            }

            .navbar .d-flex.align-items-center.gap-2.me-3 .btn span {
                display: none !important;
            }

            .navbar .view-toggle .view-toggle-btn span {
                display: none !important;
            }
        }

        @media (max-width: 992px) {
            .navbar .d-flex.align-items-center.gap-2.me-3 {
                display: none !important;
            }

            .navbar .view-toggle {
                margin-right: 0.5rem !important;
            }
        }

        @media (max-width: 768px) {
            .navbar .view-toggle {
                display: none !important;
            }

            .navbar .d-flex.align-items-center.gap-3 {
                gap: 0.5rem !important;
            }
        }

        /* Mobile navigation adjustments */
        @media (max-width: 1024px) {
            .nav-links {
                gap: 0.25rem;
            }

            .nav-link span {
                display: none;
            }

            .nav-link {
                padding: 0.5rem;
                min-width: 40px;
                justify-content: center;
            }

            .nav-divider {
                margin: 0 0.25rem;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                flex-wrap: wrap;
                gap: 0.25rem;
            }

            .nav-link {
                padding: 0.375rem;
                font-size: 0.75rem;
            }

            .nav-divider {
                display: none;
            }
        }

        /* Main Layout */
        .main-content {
            min-height: calc(100vh - 80px);
            padding: 2rem 0;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* Welcome Section */
        .welcome-section {
            text-align: center;
            margin-bottom: 3rem;
        }

        .welcome-title {
            font-size: 3rem;
        font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: 1.25rem;
            color: var(--gray-600);
            font-weight: 400;
        }


        /* Action Bar */
        .action-bar {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 20px var(--shadow-medium);
            border: 1px solid var(--border-secondary);
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: space-between;
        }

        .primary-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        /* x.ai Buttons - Clean & Professional */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: 0.875rem;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0.025em;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            min-height: 44px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .btn-success:hover {
            background: #28CD41;
            border-color: #28CD41;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--border-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: rgba(142, 142, 147, 0.3);
        }

        /* View Toggle */
        .view-toggle {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 0.25rem;
            border: 1px solid var(--border-primary);
        }

        .view-toggle-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .view-toggle-btn.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
            box-shadow: var(--shadow-medium);
        }

        /* Table View */
        .tasks-table {
            background: var(--bg-card) !important;
            backdrop-filter: blur(10px);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-heavy);
            border: 1px solid var(--border-secondary);
        }

        .table {
            margin: 0;
            border-collapse: separate;
            border-spacing: 0;
            background: transparent !important;
        }

      .table thead th {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-primary);
            font-weight: 500;
            color: var(--text-secondary);
            padding: 1rem;
            text-align: left;
        position: sticky;
        top: 0;
            z-index: 10;
            font-size: 0.875rem;
            text-transform: none;
            letter-spacing: 0.025em;
        }

        .table tbody tr {
            border-bottom: 1px solid var(--border-primary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-secondary) !important;
            color: var(--text-primary) !important;
        }

        .table tbody tr:hover {
            background: linear-gradient(135deg,
                var(--bg-tertiary),
                var(--bg-secondary));
            transform: scale(1.01);
        }

        .table td {
            padding: 1.25rem 1rem;
            vertical-align: middle;
            border: none;
            font-size: 0.9rem;
            color: var(--text-primary) !important;
            background: transparent !important;
        }

        .table-task-id {
            font-weight: 600;
            color: var(--text-primary);
        }

        .table-task-description {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: var(--text-primary);
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .table-action-btn {
            width: 2rem;
            height: 2rem;
            border-radius: var(--radius-sm);
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .table-action-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        /* Filters */
        .filters-section {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 20px var(--shadow-medium);
            border: 1px solid var(--border-secondary);
        }

        .filter-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .filter-title {
            font-weight: 600;
            color: var(--gray-900);
        }

        .quick-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .quick-filter-btn {
            padding: 0.375rem 0.75rem;
            border: 1px solid var(--border-primary);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-filter-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--border-primary);
        }

        .quick-filter-btn.active {
            background: var(--primary);
            color: var(--text-primary);
            border-color: var(--primary);
        }

        /* Saved Filters */
        .saved-filters-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-secondary);
        }

        .saved-filters-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .saved-filters-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .saved-filters-title i {
            color: var(--primary);
        }

        .saved-filters-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .saved-filter-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .saved-filter-item:hover {
            background: var(--primary-light);
            color: var(--primary);
            border-color: var(--primary);
        }

        .saved-filter-item.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .saved-filter-name {
            font-weight: 500;
        }

        .saved-filter-delete {
            margin-left: auto;
            padding: 0.125rem;
            background: none;
            border: none;
            color: inherit;
            opacity: 0.7;
            cursor: pointer;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .saved-filter-delete:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
        }

        .advanced-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            padding: 0.5rem;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Tasks Grid */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        /* x.ai Task Cards - Clean & Professional */
        .task-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-primary);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--primary);
            opacity: 0.6;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: rgba(0, 122, 255, 0.2);
        }

        /* Priority Border Indicators - Clean */
        .task-card.priority-high::before {
            background: var(--danger);
        }

        .task-card.priority-medium::before {
            background: var(--warning);
        }

        .task-card.priority-low::before {
            background: var(--success);
        }

        /* Overdue Tasks - Subtle */
        .task-card.overdue {
            border-color: rgba(255, 59, 48, 0.15);
        }

        .task-card.overdue::before {
            background: var(--danger);
            opacity: 0.8;
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.3); }
            50% { box-shadow: 0 0 0 8px rgba(220, 38, 38, 0.1); }
        }

        /* Time-based Color Coding */
        .task-card.due-soon {
            background: linear-gradient(135deg, rgba(217, 119, 6, 0.05) 0%, rgba(217, 119, 6, 0.02) 100%);
        }

        .task-card.due-today {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.05) 0%, rgba(220, 38, 38, 0.02) 100%);
            border-color: rgba(220, 38, 38, 0.2);
        }

        /* Enhanced Priority Badges */
        .priority-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .priority-badge.high {
            background: linear-gradient(135deg, var(--danger) 0%, rgba(220, 38, 38, 0.8) 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
        }

        .priority-badge.medium {
            background: linear-gradient(135deg, var(--warning) 0%, rgba(217, 119, 6, 0.8) 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);
        }

        .priority-badge.low {
            background: linear-gradient(135deg, var(--success) 0%, rgba(5, 150, 105, 0.8) 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
        }

        /* Enhanced Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.not-started {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .status-badge.in-progress {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        .status-badge.completed {
            background: linear-gradient(135deg, var(--success) 0%, rgba(5, 150, 105, 0.8) 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
        }

        .status-badge.on-hold {
            background: linear-gradient(135deg, var(--warning) 0%, rgba(217, 119, 6, 0.8) 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(217, 119, 6, 0.3);
        }

        /* Progress Indicators */
        .progress-bar {
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Quick Add Feature */
        .quick-add-container {
            position: fixed;
            top: 80px;
            right: 20px;
            left: 20px;
            z-index: 1060;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-xl);
            animation: slideDown 0.3s ease-out;
            max-width: 600px;
            margin: 0 auto;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .quick-add-wrapper {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quick-add-input {
            flex: 1;
            font-size: 1.1rem;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-secondary);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .quick-add-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            outline: none;
        }

        .quick-add-submit, .quick-add-cancel {
            padding: 0.75rem;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 44px;
            transition: all 0.2s ease;
        }

        .quick-add-submit:hover {
            transform: scale(1.05);
        }

        .quick-add-cancel:hover {
            transform: scale(1.05);
        }

        .quick-add-hint {
            margin-top: 0.75rem;
            text-align: center;
        }

        /* Filter Drawer */
        .filter-drawer {
            position: fixed;
            top: 80px;
            left: 0;
            width: 380px;
            height: calc(100vh - 80px);
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-secondary);
            box-shadow: var(--shadow-xl);
            z-index: 1040;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        .filter-drawer.open {
            transform: translateX(0);
        }

        .filter-drawer-content {
            padding: 0;
        }

        .filter-drawer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-primary);
            background: var(--bg-secondary);
        }

        .filter-drawer-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
            color: var(--text-primary);
        }

        .filter-drawer-body {
            padding: 1.5rem;
        }

        .drawer-section {
            margin-bottom: 2rem;
        }

        .drawer-section:last-child {
            margin-bottom: 0;
        }

        .drawer-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .saved-filters-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .saved-filters-header .drawer-section-title {
            margin-bottom: 0;
        }

        /* Filter Drawer Overlay */
        .filter-drawer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1030;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .filter-drawer-overlay.active {
            opacity: 1;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .quick-add-container {
                top: 70px;
                right: 15px;
                left: 15px;
                padding: 1rem;
            }

            .quick-add-input {
                font-size: 1rem;
                padding: 0.625rem 0.875rem;
            }

            .quick-add-submit, .quick-add-cancel {
                padding: 0.625rem;
                min-width: 40px;
            }

            .filter-drawer {
                width: 100%;
                top: 70px;
                height: calc(100vh - 70px);
            }

            .filter-drawer-header {
                padding: 1rem;
            }

            .filter-drawer-body {
                padding: 1rem;
            }
        }

        .task-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .task-id {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-500);
            background: var(--gray-100);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
        }

        .task-status {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed { background: var(--success); color: white; }
        .status-in-progress { background: var(--primary); color: white; }
        .status-not-started { background: var(--gray-400); color: var(--text-primary); }
        .status-on-hold { background: var(--warning); color: var(--gray-900); }

        .task-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .task-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .task-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .task-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .task-meta-item i {
            width: 16px;
            color: var(--gray-400);
        }

        .task-priority {
            padding: 0.125rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-critical { background: #fee2e2; color: #dc2626; }
        .priority-high { background: #fed7aa; color: #ea580c; }
        .priority-medium { background: #fde68a; color: #d97706; }
        .priority-low { background: #d1fae5; color: #059669; }

        .task-actions {
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .task-card:hover .task-actions {
            opacity: 1;
        }

        .task-action-btn {
            width: 2rem;
            height: 2rem;
            border-radius: var(--radius-sm);
            border: none;
            background: transparent;
            color: var(--gray-400);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .task-action-btn:hover {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        /* Kanban Board */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .kanban-column {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: 1rem;
            min-height: 500px;
        }

        .kanban-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .kanban-title {
            font-weight: 600;
            color: var(--gray-900);
        }

        .kanban-count {
            background: var(--gray-200);
            color: var(--gray-700);
            padding: 0.125rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .kanban-cards {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            min-height: 200px;
            padding: 1rem;
            border-radius: var(--radius-lg);
            transition: all 0.2s ease;
        }

        .kanban-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: 1rem;
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-secondary);
            cursor: move;
            transition: all 0.2s ease;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .kanban-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-1px);
        }

        .kanban-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            z-index: 1000;
        }

        .kanban-cards.drag-over {
            background: rgba(99, 102, 241, 0.1);
            border: 2px dashed var(--primary);
            border-radius: var(--radius-lg);
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--gray-500);
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .empty-description {
            color: var(--gray-600);
            margin-bottom: 1.5rem;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
        color: white;
            font-size: 1.25rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.2s ease;
            z-index: 1000;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }

        /* Modals */
        .modal-content {
            border: none;
            border-radius: var(--radius-xl);
            box-shadow: 0 25px 50px -12px var(--shadow-heavy);
            backdrop-filter: blur(20px);
            background: var(--bg-secondary);
            border: 1px solid var(--border-secondary);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            padding: 2rem;
            position: relative;
        }

        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }

        .modal-title {
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1.75rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.75rem;
            display: block;
            font-size: 0.9rem;
            letter-spacing: 0.025em;
        }

        /* x.ai Form Controls - Clean & Professional */
        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            transition: all 0.2s ease;
            background: var(--bg-card);
            color: var(--text-primary);
            font-weight: 400;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .form-control::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Select styling */
        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23636666' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1rem;
            padding-right: 2.5rem;
        }

        /* Textarea specific */
        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }

            .primary-actions {
                flex-direction: column;
                width: 100%;
            }

            .btn-modern {
                width: 100%;
                justify-content: center;
            }

            .advanced-filters {
                grid-template-columns: 1fr;
            }

            .tasks-grid {
                grid-template-columns: 1fr;
            }

            .kanban-board {
                grid-template-columns: 1fr;
            }

            .fab {
                bottom: 1rem;
                right: 1rem;
                width: 3rem;
                height: 3rem;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .dashboard-container {
                padding: 0 1rem;
            }

            .welcome-section {
                margin-bottom: 2rem;
            }

            .stats-card {
                padding: 1.5rem;
            }

            .task-card {
                padding: 1rem;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide-in {
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        /* Enhanced Hover Effects */
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stats-card:hover .stats-icon {
            transform: scale(1.05);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg,
                var(--gray-900) 0%,
                var(--gray-700) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stats-card:hover .stats-number {
            background: linear-gradient(135deg,
                var(--primary) 0%,
                var(--primary-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transform: scale(1.05);
        }

        .stats-label {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
            transition: all 0.3s ease;
        }


        /* Loading States */
        .loading-skeleton {
            background: linear-gradient(90deg, var(--gray-200) 25%, var(--gray-300) 50%, var(--gray-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-md);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Enhanced notification animations */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Glassmorphism Effect */
        .glass {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-secondary);
        }

        /* x.ai Modern Task Details Styles */
        .modern-task-details {
            padding: 0;
        }

        .task-header-section {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-primary);
            padding: 1.5rem;
            position: relative;
        }

        .task-header-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0;
        }

        .task-type-icon {
            flex-shrink: 0;
        }

        .icon-circle {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            box-shadow: var(--shadow);
        }

        .task-main-info {
            flex: 1;
            min-width: 0;
        }

        .task-info-row {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .task-details-compact {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-left: auto;
        }

        .task-id-compact {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
            font-weight: 600;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
            letter-spacing: 0.025em;
        }

        .status-priority-inline {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.5rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 0.5rem;
            border: 1px solid var(--border-primary);
        }

        .status-dot, .priority-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .status-text-compact, .priority-text-compact {
            font-size: 0.75rem;
            font-weight: 500;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
        }

        .priority-separator {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin: 0 0.125rem;
        }

        .timeline-inline {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: 1rem;
            padding-left: 1rem;
            border-left: 1px solid var(--border-primary);
        }

        .timeline-item-inline {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-family: 'SF Pro Text', -apple-system, sans-serif;
            font-weight: 400;
        }

        .timeline-item-inline i {
            width: 0.875rem;
            height: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            opacity: 0.7;
        }

        .timeline-item-inline.due-date {
            color: var(--warning);
        }

        .timeline-item-inline.due-date i {
            color: var(--warning);
        }


        .task-title {
            font-family: 'SF Pro Display', -apple-system, sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 0.75rem 0;
            line-height: 1.2;
            letter-spacing: -0.025em;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1rem;
        }

        .task-id-chip {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
            letter-spacing: 0.025em;
        }

        .task-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .badge-modern {
            padding: 0.25rem 0.75rem;
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
        }

        .badge-modern.type {
            background: rgba(0, 122, 255, 0.1);
            color: var(--primary);
        }

        .badge-modern.product {
            background: rgba(52, 199, 89, 0.1);
            color: #34C759;
        }

        .badge-modern.module {
            background: rgba(255, 149, 0, 0.1);
            color: #FF9500;
        }

        .badge-modern.requester {
            background: rgba(175, 82, 222, 0.1);
            color: #AF52DE;
        }

        .badge-modern.business-unit {
            background: rgba(255, 59, 48, 0.1);
            color: #FF3B30;
        }

        /* Status dots for compact layout */
        .status-dot.status-not-started { background: var(--gray-400); }
        .status-dot.status-in-progress { background: var(--primary); }
        .status-dot.status-completed { background: #34C759; }
        .status-dot.status-on-hold { background: #FF9500; }
        .status-dot.status-cancelled { background: var(--danger); }

        .priority-dot.priority-low { background: #34C759; }
        .priority-dot.priority-medium { background: #FF9500; }
        .priority-dot.priority-high { background: var(--danger); }


        .action-plan-section {
            padding: 1.5rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'SF Pro Display', -apple-system, sans-serif;
        }

        .section-title i {
            color: var(--primary);
        }

        .standup-btn {
            background: var(--primary);
            color: white;
            border: 1px solid var(--primary);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 500;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .standup-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .current-plan, .plan-history {
            margin-bottom: 2rem;
        }

        .plan-header {
            margin-bottom: 1rem;
        }

        .plan-status {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
        }

        .plan-status.active {
            color: #34C759;
        }

        .plan-status.active .status-indicator {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background: #34C759;
        }

        .plan-status.history {
            color: var(--text-muted);
        }

        .plan-content {
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .plan-content.history {
            background: var(--bg-secondary);
            border: 1px solid rgba(142, 142, 147, 0.2);
        }

        .plan-content.history pre {
            margin: 0;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
            font-size: 0.875rem;
            white-space: pre-wrap;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .no-plan {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
            font-style: italic;
            font-family: 'SF Pro Text', -apple-system, sans-serif;
        }

        /* Utility Classes */
        .text-gradient {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .shadow-soft {
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <div class="logo-container me-2">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="4" y="8" width="24" height="16" rx="2" fill="url(#gradient1)"/>
                        <rect x="8" y="12" width="16" height="2" rx="1" fill="white"/>
                        <rect x="8" y="16" width="12" height="2" rx="1" fill="white" opacity="0.8"/>
                        <rect x="8" y="20" width="8" height="2" rx="1" fill="white" opacity="0.6"/>
                        <circle cx="24" cy="6" r="4" fill="url(#gradient2)"/>
                        <text x="24" y="9" text-anchor="middle" fill="white" font-size="6" font-weight="bold">+</text>
                        <defs>
                            <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6"/>
                                <stop offset="100%" style="stop-color:#1d4ed8"/>
                            </linearGradient>
                            <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#10b981"/>
                                <stop offset="100%" style="stop-color:#059669"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="brand-text">
                    <span class="brand-name">Progress Pad</span>
                    <span class="brand-subtitle d-none d-lg-inline">Task Management</span>
                </div>
            </a>

            <!-- Modern Navigation Menu -->
            <nav class="modern-nav">
                <div class="nav-links">
                    <a href="#" class="nav-link active" data-bs-toggle="modal" data-bs-target="#addTaskModal">
                        <i class="fas fa-plus"></i>
                        <span>Add Task</span>
                    </a>

                    <button type="button" class="btn btn-secondary btn-sm" id="quickAddBtn" title="Quick Add Task" onclick="console.log('Quick Add button clicked directly')">
                        <i class="fas fa-bolt"></i>
                        <span>Quick Add</span>
                    </button>

                    <div class="nav-divider"></div>

                    <button type="button" class="btn btn-secondary btn-sm" id="filterToggleBtn" title="Toggle Filters" onclick="console.log('Filter button clicked directly')">
                        <i class="fas fa-filter"></i>
                        <span>Filters</span>
                    </button>

                    <button class="nav-link" data-bs-toggle="modal" data-bs-target="#settingsModal">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>

                    <div class="nav-divider"></div>

                    <a href="/analytics" class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Analytics</span>
                    </a>

                    <button class="nav-link" data-bs-toggle="modal" data-bs-target="#importExportModal">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Import</span>
                    </button>

                    {% if current_user.is_admin %}
                    <a href="{{ url_for('manage_users') }}" class="nav-link admin-link">
                        <i class="fas fa-user-cog"></i>
                        <span>Users</span>
                    </a>
                    {% endif %}
                </div>
            </nav>

            <!-- Quick Add Input -->
            <div class="quick-add-container" id="quickAddContainer" style="display: none;">
                <div class="quick-add-wrapper">
                    <input type="text" class="form-control quick-add-input" id="quickAddInput"
                           placeholder="Type task description and press Enter..."
                           autocomplete="off">
                    <button class="btn btn-primary quick-add-submit" id="quickAddSubmit">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="btn btn-outline-secondary quick-add-cancel" id="quickAddCancel">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="quick-add-hint">
                    <small class="text-muted">Press Enter to add task  Esc to cancel</small>
                </div>
            </div>

            <!-- View Toggle -->
            <div class="view-toggle me-3">
                <button class="view-toggle-btn active" id="tableViewBtn">
                    <i class="fas fa-table"></i>
                    <span class="d-none d-sm-inline ms-1">Table</span>
                </button>
                <button class="view-toggle-btn" id="kanbanViewBtn">
                    <i class="fas fa-columns"></i>
                    <span class="d-none d-sm-inline ms-1">Kanban</span>
                </button>
        </div>

            <!-- Time, Greeting & Theme Toggle -->
            <div class="d-flex align-items-center gap-3">
                <span id="currentTime" class="text-muted small"></span>
                <span id="greetingBadge" class="badge bg-primary"></span>
                <span id="taskCountBadge" class="badge bg-info d-none d-sm-inline" title="Total Tasks">0 tasks</span>
                <button id="keyboardHelpBtn" class="btn btn-outline-secondary btn-sm" title="Keyboard Shortcuts">
                    <i class="fas fa-keyboard"></i>
                </button>
            </div>

            <!-- User Menu -->
            <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-user-circle me-2"></i>
                    <span class="d-none d-md-inline">{{ current_user.username }}</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li><h6 class="dropdown-header">{{ current_user.username }}</h6></li>
                    <li><span class="dropdown-item-text small text-muted">{{ current_user.email }}</span></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Collapsible Filter Drawer -->
    <div class="filter-drawer" id="filterDrawer" style="display: none;">
        <div class="filter-drawer-content">
            <div class="filter-drawer-header">
                <h5 class="filter-drawer-title">
                    <i class="fas fa-filter me-2"></i>Filters & Search
                </h5>
                <button class="btn btn-sm btn-outline-secondary" id="closeFilterDrawer">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="filter-drawer-body">
                <!-- Quick Filters -->
                <div class="drawer-section">
                    <h6 class="drawer-section-title">Quick Filters</h6>
                    <div class="quick-filters">
                        <button class="quick-filter-btn" data-filter="all">
                            <i class="fas fa-list"></i>
                            All Tasks
                        </button>
                        <button class="quick-filter-btn" data-filter="completed">
                            <i class="fas fa-check"></i>
                            Completed
                        </button>
                        <button class="quick-filter-btn" data-filter="in-progress">
                            <i class="fas fa-play"></i>
                            In Progress
                        </button>
                        <button class="quick-filter-btn" data-filter="overdue">
                            <i class="fas fa-exclamation-triangle"></i>
                            Overdue
                        </button>
                        <button class="quick-filter-btn" data-filter="high-priority">
                            <i class="fas fa-exclamation-circle"></i>
                            High Priority
                        </button>
                    </div>
                </div>

                <!-- Saved Filters -->
                <div class="drawer-section">
                    <div class="saved-filters-header">
                        <h6 class="drawer-section-title">
                            <i class="fas fa-bookmark me-1"></i>Saved Filters
                        </h6>
                        <button class="btn btn-sm btn-outline-primary" id="saveCurrentFilterBtn">
                            <i class="fas fa-save"></i>
                            Save Current
                        </button>
                    </div>
                    <div class="saved-filters-list" id="savedFiltersList">
                        <!-- Saved filters will be dynamically added here -->
                    </div>
                </div>

                <!-- Advanced Filters -->
                <div class="drawer-section">
                    <h6 class="drawer-section-title">Advanced Filters</h6>
                    <div class="advanced-filters">
                        <div class="filter-group">
                            <label class="filter-label">Status</label>
                            <select class="filter-select" id="statusFilter">
                                <option value="">All Statuses</option>
            {% for status in settings['status_options'] %}
            <option value="{{ status }}">{{ status }}</option>
            {% endfor %}
          </select>
        </div>

                        <div class="filter-group">
                            <label class="filter-label">Priority</label>
                            <select class="filter-select" id="priorityFilter">
                                <option value="">All Priorities</option>
                            {% for priority in settings['priority_options'] %}
                            <option value="{{ priority }}">{{ priority }}</option>
            {% endfor %}
          </select>
        </div>

                        <div class="filter-group">
                            <label class="filter-label">Type</label>
                            <select class="filter-select" id="typeFilter">
                                <option value="">All Types</option>
            {% for type in settings['type_options'] %}
            <option value="{{ type }}">{{ type }}</option>
            {% endfor %}
          </select>
        </div>

                        <div class="filter-group">
                            <label class="filter-label">Search</label>
                            <input type="text" class="filter-select" id="searchInput" placeholder="Search tasks...">
      </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Drawer Overlay -->
    <div class="filter-drawer-overlay" id="filterOverlay" style="display: none;"></div>

    <main class="main-content">
        <div class="dashboard-container">







            <!-- Tasks Container -->
            <div id="tasksContainer">
                <!-- Loading Skeleton -->
                <div id="loadingSkeleton" class="loading-skeleton" style="display: none;">
                    <div class="skeleton-header">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-actions">
                            <div class="skeleton-button"></div>
                            <div class="skeleton-button"></div>
                        </div>
                    </div>
                    <div class="skeleton-table">
                        <div class="skeleton-row">
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                        </div>
                        <div class="skeleton-row">
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                        </div>
                        <div class="skeleton-row">
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                            <div class="skeleton-cell"></div>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-state-content">
                        <div class="empty-state-icon">
                            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h3 class="empty-state-title">No tasks found</h3>
                        <p class="empty-state-description">Get started by creating your first task or adjusting your filters.</p>
                        <button class="btn btn-primary empty-state-action" onclick="document.querySelector('[data-bs-toggle=\"modal\"][data-bs-target=\"#addTaskModal\"]').click()">
                            <i class="fas fa-plus me-2"></i>Create Your First Task
                        </button>
                    </div>
                </div>

                <!-- Table View -->
                <div id="tableView" class="tasks-table fade-in">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Description</th>
                                <th>Type</th>
                                <th>Product</th>
                                <th>Module</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Due Date</th>
                                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
                            <tr data-status="{{ task['Status'] }}" data-priority="{{ task['Priority'] }}" data-type="{{ task['Type'] }}" data-description="{{ task['Description'] }}">
                                <td>
                                    <span class="table-task-id">{{ task['ID'] }}</span>
                                </td>
                                <td>
                                    <div class="table-task-description" title="{{ task['Description'] }}">
                                        {{ task['Description'] }}
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark">{{ task['Type'] }}</span>
                                </td>
                                <td>
                                    {% if task['Product'] %}
                                    <span class="badge bg-info">{{ task['Product'] }}</span>
                                    {% else %}
                                    <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if task['Module'] %}
                                    <span class="badge bg-success">{{ task['Module'] }}</span>
                                    {% else %}
                                    <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="task-status status-{{ task['Status'].lower().replace(' ', '-') }}">
                  {{ task['Status'] }}
                                    </span>
                </td>
                                <td>
                                    <span class="task-priority priority-{{ task['Priority'].lower() }}">
                                        {{ task['Priority'] }}
                                    </span>
                                </td>
                <td>
                  {% if task['Due Date'] %}
                                        <span class="{% if task['is_overdue'] %}text-danger{% else %}text-dark{% endif %}">
                                            {{ task['Due Date'] }}
                                            {% if task['is_overdue'] %}
                                                <i class="fas fa-exclamation-circle text-danger ms-1"></i>
                                            {% endif %}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                  {% endif %}
                </td>
                                <td>
                                    <div class="table-actions">
                                        <button class="table-action-btn" title="Edit Task" onclick="editTask('{{ task['ID'] }}')">
                                            <i class="fas fa-edit"></i>
                    </button>
                                        <button class="table-action-btn" title="View Details" onclick="viewTask('{{ task['ID'] }}')">
                                            <i class="fas fa-eye"></i>
                    </button>
                                                <button class="table-action-btn" title="Standup Action Plan Update" onclick="standupUpdateActionPlan('{{ task['ID'] }}')" style="color: #0d6efd;">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                        <button class="table-action-btn" title="Quick Complete" onclick="updateTaskStatus('{{ task['ID'] }}', 'Completed')" style="color: #10b981;" title="Mark as Completed">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="table-action-btn" title="Delete Task" onclick="deleteTask('{{ task['ID'] }}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                  </div>
                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
</div>

                <!-- Kanban View -->
                <div id="kanbanView" class="kanban-board" style="display: none;">
                    <!-- Not Started Column -->
                    <div class="kanban-column">
                        <div class="kanban-header">
                            <h4 class="kanban-title">
                                <i class="fas fa-circle text-muted"></i>
                                Not Started
                            </h4>
                            <span class="kanban-count" id="not-started-count">0</span>
      </div>
                        <div class="kanban-cards" id="not-started-column">
                            {% for task in tasks %}
                                {% if task['Status'] == 'Not Started' %}
                                <div class="kanban-card" data-task-id="{{ task['ID'] }}" draggable="true">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="task-priority priority-{{ task['Priority'].lower() }} badge">{{ task['Priority'] }}</span>
                                        <small class="text-muted">{{ task['ID'] }}</small>
                                    </div>
                                    <h6 class="mb-2">{{ task['Description'] }}</h6>
                                    <div class="small text-muted">
                                        <div><i class="fas fa-tag me-1"></i>{{ task['Type'] }}</div>
                                        <div><i class="fas fa-folder me-1"></i>{{ task['Category'] }}</div>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
</div>

                    <!-- In Progress Column -->
                    <div class="kanban-column">
                        <div class="kanban-header">
                            <h4 class="kanban-title">
                                <i class="fas fa-play text-primary"></i>
                                In Progress
                            </h4>
                            <span class="kanban-count" id="in-progress-count">0</span>
      </div>
                        <div class="kanban-cards" id="in-progress-column">
                            {% for task in tasks %}
                                {% if task['Status'] == 'In Progress' %}
                                <div class="kanban-card" data-task-id="{{ task['ID'] }}" draggable="true">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="task-priority priority-{{ task['Priority'].lower() }} badge">{{ task['Priority'] }}</span>
                                        <small class="text-muted">{{ task['ID'] }}</small>
                                    </div>
                                    <h6 class="mb-2">{{ task['Description'] }}</h6>
                                    <div class="small text-muted">
                                        <div><i class="fas fa-tag me-1"></i>{{ task['Type'] }}</div>
                                        <div><i class="fas fa-folder me-1"></i>{{ task['Category'] }}</div>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
  </div>
</div>

                    <!-- Completed Column -->
                    <div class="kanban-column">
                        <div class="kanban-header">
                            <h4 class="kanban-title">
                                <i class="fas fa-check text-success"></i>
                                Completed
                            </h4>
                            <span class="kanban-count" id="completed-count">0</span>
      </div>
                        <div class="kanban-cards" id="completed-column">
                            {% for task in tasks %}
                                {% if task['Status'] == 'Completed' %}
                                <div class="kanban-card" data-task-id="{{ task['ID'] }}" draggable="true">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="task-priority priority-{{ task['Priority'].lower() }} badge">{{ task['Priority'] }}</span>
                                        <small class="text-muted">{{ task['ID'] }}</small>
                                    </div>
                                    <h6 class="mb-2">{{ task['Description'] }}</h6>
                                    <div class="small text-muted">
                                        <div><i class="fas fa-tag me-1"></i>{{ task['Type'] }}</div>
                                        <div><i class="fas fa-folder me-1"></i>{{ task['Category'] }}</div>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
      </div>
    </div>

                    <!-- On Hold Column -->
                    <div class="kanban-column">
                        <div class="kanban-header">
                            <h4 class="kanban-title">
                                <i class="fas fa-pause text-warning"></i>
                                On Hold
                            </h4>
                            <span class="kanban-count" id="on-hold-count">0</span>
                        </div>
                        <div class="kanban-cards" id="on-hold-column">
                            {% for task in tasks %}
                                {% if task['Status'] == 'On Hold' %}
                                <div class="kanban-card" data-task-id="{{ task['ID'] }}" draggable="true">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="task-priority priority-{{ task['Priority'].lower() }} badge">{{ task['Priority'] }}</span>
                                        <small class="text-muted">{{ task['ID'] }}</small>
                                    </div>
                                    <h6 class="mb-2">{{ task['Description'] }}</h6>
                                    <div class="small text-muted">
                                        <div><i class="fas fa-tag me-1"></i>{{ task['Type'] }}</div>
                                        <div><i class="fas fa-folder me-1"></i>{{ task['Category'] }}</div>
                                    </div>
                                </div>
                                {% endif %}
                            {% endfor %}
                        </div>
  </div>
</div>

                <!-- Empty State -->
                {% if not tasks %}
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <h3 class="empty-title">No tasks yet</h3>
                    <p class="empty-description">Create your first task to get started with your task management dashboard.</p>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addTaskModal">
                        <i class="fas fa-plus"></i>
                        Add Your First Task
                    </button>
                </div>
                {% endif %}
            </div>

            <!-- Floating Action Button -->
            <button class="fab" data-bs-toggle="modal" data-bs-target="#addTaskModal">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </main>

<!-- Add Task Modal -->
<div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
                    <h5 class="modal-title" id="addTaskModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>Add New Task
                    </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
                    <form id="addTaskForm">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">Type</label>
                                    <select class="form-control" name="Type" required>
                                        <option value="" disabled selected>Choose task type...</option>
            {% for type in settings['type_options'] %}
            <option value="{{ type }}">{{ type }}</option>
            {% endfor %}
          </select>
        </div>
        </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">Product</label>
                                    <select class="form-control" name="Product" required>
                                        <option value="" disabled selected>Choose product...</option>
            {% for product in settings['product_options'] %}
            <option value="{{ product }}">{{ product }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">Module</label>
                                    <select class="form-control" name="Module" required>
                                        <option value="" disabled selected>Choose module...</option>
            {% for module in settings['module_options'] %}
            <option value="{{ module }}">{{ module }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <input class="form-control" name="Description" placeholder="What needs to be done?" required>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" name="Status" required>
                                        <option value="" disabled selected>Current status...</option>
            {% for status in settings['status_options'] %}
            <option value="{{ status }}">{{ status }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Priority</label>
                                    <select class="form-control" name="Priority" required>
                                        <option value="" disabled selected>How urgent is this?</option>
                                        {% for priority in settings['priority_options'] %}
                                        <option value="{{ priority }}">{{ priority }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Requester</label>
                                    <input class="form-control" type="text" name="Requester" placeholder="Who requested this task?">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Business Unit</label>
                                    <input class="form-control" type="text" name="Business Unit" placeholder="Which business unit?">
                                </div>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Due Date</label>
                                    <input class="form-control" type="date" name="Due Date">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Created Date</label>
                                    <input class="form-control" type="date" name="Created Date" id="createdDateInput">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Current Action Plan</label>
                            <textarea class="form-control" name="Current Action Plan" rows="3" placeholder="What's your plan to tackle this task?"></textarea>
                        </div>

          {% for col in settings['custom_columns'] %}
                        <div class="form-group">
                            <label class="form-label">{{ col.name }}</label>
                            {% if col.type == 'date' %}
                            <input class="form-control" type="date" name="{{ col.name }}">
                            {% elif col.type == 'number' %}
                            <input class="form-control" type="number" name="{{ col.name }}" placeholder="{{ col.name }}">
                            {% else %}
                            <input class="form-control" type="text" name="{{ col.name }}" placeholder="{{ col.name }}">
                            {% endif %}
                        </div>
          {% endfor %}
        </form>
      </div>
      <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" onclick="submitAddTask()">
                        <i class="fas fa-plus me-2"></i>Add Task
                    </button>
      </div>
    </div>
  </div>
</div>

    <!-- Edit Task Modal -->
    <div class="modal fade" id="editTaskModal" tabindex="-1" aria-labelledby="editTaskModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
                    <h5 class="modal-title" id="editTaskModalLabel">
                        <i class="fas fa-edit me-2"></i>Edit Task
                    </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
                    <form id="editTaskForm">
                        <input type="hidden" name="ID">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">Type</label>
                                    <select class="form-control" name="Type" required>
                                        <option value="" disabled>Choose task type...</option>
            {% for type in settings['type_options'] %}
            <option value="{{ type }}">{{ type }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">Product</label>
                                    <select class="form-control" name="Product" required>
                                        <option value="" disabled>Choose product...</option>
            {% for product in settings['product_options'] %}
            <option value="{{ product }}">{{ product }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label">Module</label>
                                    <select class="form-control" name="Module" required>
                                        <option value="" disabled>Choose module...</option>
            {% for module in settings['module_options'] %}
            <option value="{{ module }}">{{ module }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <input class="form-control" name="Description" placeholder="What needs to be done?" required>
          </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" name="Status" required>
                                        <option value="" disabled>Current status...</option>
            {% for status in settings['status_options'] %}
            <option value="{{ status }}">{{ status }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Priority</label>
                                    <select class="form-control" name="Priority" required>
                                        <option value="" disabled>How urgent is this?</option>
                                        {% for priority in settings['priority_options'] %}
                                        <option value="{{ priority }}">{{ priority }}</option>
            {% endfor %}
          </select>
                                </div>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Requester</label>
                                    <input class="form-control" type="text" name="Requester" placeholder="Who requested this task?">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Business Unit</label>
                                    <input class="form-control" type="text" name="Business Unit" placeholder="Which business unit?">
                                </div>
                            </div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Due Date</label>
                                    <input class="form-control" type="date" name="Due Date">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Created Date</label>
                                    <input class="form-control" type="date" name="Created Date">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Current Action Plan</label>
                            <textarea class="form-control" name="Current Action Plan" rows="3" placeholder="What's your current plan?"></textarea>
                        </div>

          {% for col in settings['custom_columns'] %}
                        <div class="form-group">
                            <label class="form-label">{{ col.name }}</label>
                            {% if col.type == 'date' %}
                            <input class="form-control" type="date" name="{{ col.name }}">
                            {% elif col.type == 'number' %}
                            <input class="form-control" type="number" name="{{ col.name }}" placeholder="{{ col.name }}">
                            {% else %}
                            <input class="form-control" type="text" name="{{ col.name }}" placeholder="{{ col.name }}">
                            {% endif %}
                        </div>
          {% endfor %}
        </form>
      </div>
      <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" onclick="submitEditTask()">
                        <i class="fas fa-save me-2"></i>Save Changes
                    </button>
      </div>
    </div>
  </div>
</div>

    <!-- View Task Modal -->
    <div class="modal fade" id="viewTaskModal" tabindex="-1" aria-labelledby="viewTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewTaskModalLabel">
                        <i class="fas fa-eye me-2"></i>Task Details
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div id="taskDetailsContent">
                        <!-- Task details will be loaded here -->
                    </div>
                </div>
    </div>
  </div>
</div>

<!-- Keyboard Shortcuts Modal -->
<div class="modal fade" id="keyboardModal" tabindex="-1" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="keyboardModalLabel">
                    <i class="fas fa-keyboard me-2"></i>Keyboard Shortcuts
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <h6 class="text-primary mb-3"><i class="fas fa-tasks me-2"></i>Task Management</h6>
                        <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span>New Task</span>
                            <kbd class="bg-light px-2 py-1 rounded small">Ctrl + N</kbd>
                        </div>
                        <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span>Quick Complete</span>
                            <kbd class="bg-light px-2 py-1 rounded small">Click </kbd>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary mb-3"><i class="fas fa-eye me-2"></i>Navigation</h6>
                        <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span>Toggle Views</span>
                            <kbd class="bg-light px-2 py-1 rounded small">Ctrl + K</kbd>
                        </div>
                        <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <span>Close Modals</span>
                            <kbd class="bg-light px-2 py-1 rounded small">Esc</kbd>
                        </div>
                    </div>
                </div>
                <div class="alert alert-info mt-4">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>Pro Tips:</strong>
                    <ul class="mb-0 mt-2">
                        <li>Use <kbd>Ctrl+K</kbd> to quickly switch between Table and Kanban views</li>
                        <li>The green checkmark () button provides one-click task completion</li>
                        <li>Drag and drop cards in Kanban view to change task status</li>
                        <li>All notifications auto-dismiss after 4 seconds</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalLabel">
                        <i class="fas fa-cog me-2"></i>Settings
                    </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <h6 class="mb-3">Task Status Options</h6>
                            <div class="mb-3">
                                <label class="form-label">Current Status Options:</label>
                                <div class="d-flex flex-wrap gap-2">
                                    {% for status in settings['status_options'] %}
                                    <span class="badge bg-secondary">{{ status }}</span>
                                    {% endfor %}
            </div>
            </div>
            </div>

                        <div class="col-12">
                            <h6 class="mb-3">Priority Options</h6>
                            <div class="mb-3">
                                <label class="form-label">Current Priority Options:</label>
                                <div class="d-flex flex-wrap gap-2">
                                    {% for priority in settings['priority_options'] %}
                                    <span class="badge bg-info">{{ priority }}</span>
                                    {% endfor %}
            </div>
            </div>
          </div>

                        <div class="col-12">
                            <h6 class="mb-3">Task Type Options</h6>
                            <div class="mb-3">
                                <label class="form-label">Current Type Options:</label>
                                <div class="d-flex flex-wrap gap-2">
                                    {% for type in settings['type_options'] %}
                                    <span class="badge bg-success">{{ type }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <h6 class="mb-3">Product Options</h6>
                            <div class="mb-3">
                                <label class="form-label">Current Product Options:</label>
                                <div class="d-flex flex-wrap gap-2">
                                    {% for product in settings['product_options'] %}
                                    <span class="badge bg-primary">{{ product }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <h6 class="mb-3">Module Options</h6>
                            <div class="mb-3">
                                <label class="form-label">Current Module Options:</label>
                                <div class="d-flex flex-wrap gap-2">
                                    {% for module in settings['module_options'] %}
                                    <span class="badge bg-success">{{ module }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Note:</strong> These settings are configured in your application backend.
                                Contact your administrator to modify these options.
                            </div>
                        </div>
                    </div>
      </div>
      <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Close
                    </button>
      </div>
    </div>
  </div>
</div>

    <!-- Import/Export Modal -->
    <div class="modal fade" id="importExportModal" tabindex="-1" aria-labelledby="importExportModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="importExportModalLabel">
                <i class="fas fa-exchange-alt me-2"></i>Import/Export Tasks
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row g-4">
                <!-- Export Section -->
                <div class="col-md-6">
                    <div class="card border-0 bg-light">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="fas fa-download fa-3x text-primary"></i>
                            </div>
                            <h6 class="card-title">Export Tasks</h6>
                            <p class="card-text text-muted small">
                                Download all your tasks as a CSV file for backup or sharing.
                            </p>
                            <button class="btn btn-primary" onclick="exportTasks()">
                                <i class="fas fa-download me-2"></i>Export to CSV
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Import Section -->
                <div class="col-md-6">
                    <div class="card border-0 bg-light">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="fas fa-upload fa-3x text-success"></i>
                            </div>
                            <h6 class="card-title">Import Tasks</h6>
                            <p class="card-text text-muted small">
                                Upload a CSV file to import tasks. This will replace all existing tasks.
                            </p>
                            <form id="importForm" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <input type="file" class="form-control" id="csvFile" name="file" accept=".csv" required>
                                    <div class="form-text">
                                        <small class="text-muted">Only CSV files are supported</small>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-success" onclick="importTasks()">
                                    <i class="fas fa-upload me-2"></i>Import CSV
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="mt-4">
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle me-2"></i>CSV Format Instructions</h6>
                    <p class="mb-2">Your CSV file should contain the following columns:</p>
                    <ul class="mb-0 small">
                        <li><strong>ID</strong> - Unique task identifier</li>
                        <li><strong>Description</strong> - Task description</li>
                        <li><strong>Type</strong> - Task type</li>
                        <li><strong>Category</strong> - Task category</li>
                        <li><strong>Status</strong> - Current status</li>
                        <li><strong>Priority</strong> - Task priority</li>
                        <li><strong>Due Date</strong> - Due date (optional)</li>
                        <li><strong>Created Date</strong> - Creation date (optional)</li>
                        <li><strong>Current Action Plan</strong> - Action plan (optional)</li>
                    </ul>
                </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="fas fa-times me-2"></i>Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>


        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeTime();
            initializeFilters();
            initializeViewToggle();
            updateKanbanCounts();
            initializeTheme();

            // Debug: Check if buttons exist
            setTimeout(() => {
                const quickAddBtn = document.getElementById('quickAddBtn');
                const filterToggleBtn = document.getElementById('filterToggleBtn');
                console.log(' Debug - Buttons found:', {
                    quickAddBtn: !!quickAddBtn,
                    filterToggleBtn: !!filterToggleBtn
                });
                if (quickAddBtn) {
                    console.log('Quick Add button element:', quickAddBtn);
                    console.log('Quick Add button classes:', quickAddBtn.className);
                }
                if (filterToggleBtn) {
                    console.log('Filter button element:', filterToggleBtn);
                    console.log('Filter button classes:', filterToggleBtn.className);
                }
            }, 100);

            initializeQuickAdd();
            initializeSavedFilters();
            initializeFilterDrawer();

            // Test Kanban after a short delay
            setTimeout(() => {
                console.log(' Page loaded, testing Kanban setup...');
                const kanbanView = document.getElementById('kanbanView');
                if (kanbanView && kanbanView.style.display !== 'none') {
                    console.log('Kanban view is active, initializing drag and drop...');
                    initializeDragAndDrop();
                    updateKanbanCounts();
                } else {
                    console.log('Kanban view is not active');
                }
            }, 500);
        });

        // Time and greeting
        function initializeTime() {
            function updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
                document.getElementById('currentTime').textContent = timeString;

                const hour = now.getHours();
                let greeting = 'Good morning!';
                if (hour >= 12 && hour < 17) greeting = 'Good afternoon!';
                else if (hour >= 17) greeting = 'Good evening!';

                document.getElementById('greetingBadge').textContent = greeting;
            }

            updateTime();
            setInterval(updateTime, 60000); // Update every minute
        }


        // View toggle functionality
        function initializeViewToggle() {
            const tableViewBtn = document.getElementById('tableViewBtn');
            const kanbanViewBtn = document.getElementById('kanbanViewBtn');
            const tableView = document.getElementById('tableView');
            const kanbanView = document.getElementById('kanbanView');

            // Set table view as default (show immediately)
            if (tableView) {
                tableView.style.display = 'block';
            }
            if (kanbanView) {
                kanbanView.style.display = 'none';
            }
            if (tableViewBtn) {
                tableViewBtn.classList.add('active');
            }
            if (kanbanViewBtn) {
                kanbanViewBtn.classList.remove('active');
            }

            if (tableViewBtn) {
                tableViewBtn.addEventListener('click', function() {
                    if (tableView) tableView.style.display = 'block';
                    if (kanbanView) kanbanView.style.display = 'none';
                    tableViewBtn.classList.add('active');
                    if (kanbanViewBtn) kanbanViewBtn.classList.remove('active');
                });
            }

            if (kanbanViewBtn) {
                kanbanViewBtn.addEventListener('click', function() {
                    if (tableView) tableView.style.display = 'none';
                    if (kanbanView) kanbanView.style.display = 'grid';
                    if (tableViewBtn) tableViewBtn.classList.remove('active');
                    kanbanViewBtn.classList.add('active');
                    // Delay initialization to ensure DOM is ready
                    setTimeout(() => {
                        initializeDragAndDrop();
                        updateKanbanCounts();
                    }, 100);
                });
            }

            // Initialize drag and drop on page load if Kanban view is active
            if (kanbanView && kanbanView.style.display !== 'none') {
                setTimeout(() => {
                    initializeDragAndDrop();
                    updateKanbanCounts();
                }, 100);
            }

            // Add a global test function for debugging
            window.testKanban = function() {
                console.log(' Kanban Debug Test');
                const cards = document.querySelectorAll('.kanban-card');
                const columns = document.querySelectorAll('.kanban-cards');

                console.log(`Found ${cards.length} kanban cards:`);
                cards.forEach((card, i) => {
                    console.log(`  ${i}: ${card.dataset.taskId} - draggable: ${card.draggable}`);
                });

                console.log(`Found ${columns.length} kanban columns:`);
                columns.forEach((col, i) => {
                    console.log(`  ${i}: ${col.id}`);
                });

                return { cards: cards.length, columns: columns.length };
            };

            // Test drag manually
            window.testDrag = function(taskId) {
                console.log(' Testing drag for task:', taskId);
                const card = document.querySelector(`[data-task-id="${taskId}"]`);
                if (card) {
                    console.log('Found card:', card);
                    console.log('Card draggable:', card.draggable);
                    console.log('Card dataset:', card.dataset);
                    return true;
                } else {
                    console.error('Card not found for task:', taskId);
                    return false;
                }
            };

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + N = New Task
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    const addTaskBtn = document.querySelector('[data-bs-toggle="modal"][data-bs-target="#addTaskModal"]');
                    if (addTaskBtn) {
                        addTaskBtn.click();
                        showNotification('New task modal opened (Ctrl+N)', 'info', 2000);
                    }
                }

                // Ctrl/Cmd + K = Toggle Kanban/Table view
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    const kanbanBtn = document.getElementById('kanbanViewBtn');
                    const tableBtn = document.getElementById('tableViewBtn');
                    if (kanbanBtn && tableBtn) {
                        if (document.getElementById('kanbanView').style.display === 'grid') {
                            tableBtn.click();
                        } else {
                            kanbanBtn.click();
                        }
                    }
                }

                // Escape = Close modals and drawers
                if (e.key === 'Escape') {
                    const openModal = document.querySelector('.modal.show');
                    const openDrawer = document.querySelector('.filter-drawer[style*="display: block"]');

                    if (openModal) {
                        const bsModal = bootstrap.Modal.getInstance(openModal);
                        if (bsModal) bsModal.hide();
                    }

                    if (openDrawer) {
                        const closeBtn = document.getElementById('closeFilterDrawer');
                        if (closeBtn) closeBtn.click();
                    }
                }
            });

            // Keyboard help button
            const keyboardHelpBtn = document.getElementById('keyboardHelpBtn');
            if (keyboardHelpBtn) {
                keyboardHelpBtn.addEventListener('click', function() {
                    const keyboardModal = new bootstrap.Modal(document.getElementById('keyboardModal'));
                    keyboardModal.show();
                });
            }

            // Update task count badge
            function updateTaskCountBadge() {
                const taskCountBadge = document.getElementById('taskCountBadge');
                if (taskCountBadge) {
                    const totalTasks = document.querySelectorAll('.kanban-card').length ||
                                     document.querySelectorAll('tbody tr').length;
                    taskCountBadge.textContent = `${totalTasks} ${totalTasks === 1 ? 'task' : 'tasks'}`;
                    taskCountBadge.style.display = totalTasks > 0 ? 'inline-block' : 'none';
                }
            }

            // Update task count when tasks change
            const originalUpdateKanbanCounts = updateKanbanCounts;
            updateKanbanCounts = function() {
                originalUpdateKanbanCounts();
                updateTaskCountBadge();
            };

            // Initial update
            setTimeout(updateTaskCountBadge, 100);

        }

        // Filter functionality
        function initializeFilters() {
  const statusFilter = document.getElementById('statusFilter');
  const priorityFilter = document.getElementById('priorityFilter');
  const typeFilter = document.getElementById('typeFilter');
            const searchInput = document.getElementById('searchInput');
            const quickFilters = document.querySelectorAll('.quick-filter-btn');

  function applyFilters() {
                const statusValue = statusFilter.value;
                const priorityValue = priorityFilter.value;
                const typeValue = typeFilter.value;
                const searchValue = searchInput.value.toLowerCase();

                const tableRows = document.querySelectorAll('#tableView tbody tr');

                // Filter table rows
                tableRows.forEach(row => {
                    const rowStatus = row.dataset.status;
                    const rowPriority = row.dataset.priority;
                    const rowType = row.dataset.type;
                    const rowDescription = row.dataset.description;

                    const matchesStatus = !statusValue || rowStatus === statusValue;
                    const matchesPriority = !priorityValue || rowPriority === priorityValue;
                    const matchesType = !typeValue || rowType === typeValue;
                    const matchesSearch = !searchValue ||
                        rowDescription.toLowerCase().includes(searchValue);

                    if (matchesStatus && matchesPriority && matchesType && matchesSearch) {
                        row.style.display = 'table-row';
                    } else {
                        row.style.display = 'none';
                    }
                });

                updateKanbanCounts();
            }

            // Event listeners
            statusFilter.addEventListener('change', applyFilters);
            priorityFilter.addEventListener('change', applyFilters);
            typeFilter.addEventListener('change', applyFilters);
            searchInput.addEventListener('input', applyFilters);

            // Quick filters
            quickFilters.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    quickFilters.forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');

                    const filterType = this.dataset.filter;

                    // Reset all filters
                    statusFilter.value = '';
                    priorityFilter.value = '';
                    typeFilter.value = '';
                    searchInput.value = '';

                    // Apply quick filter
                    if (filterType === 'completed') {
                        statusFilter.value = 'Completed';
                    } else if (filterType === 'in-progress') {
                        statusFilter.value = 'In Progress';
                    } else if (filterType === 'high-priority') {
                        priorityFilter.value = 'High';
                    }

                    applyFilters();
  });
});
        }

        // Update Kanban column counts
        function updateKanbanCounts() {
            const columns = ['not-started', 'in-progress', 'completed', 'on-hold'];

            columns.forEach(column => {
                const columnEl = document.getElementById(`${column}-column`);
                const countEl = document.getElementById(`${column}-count`);

                if (columnEl && countEl) {
                    const visibleCards = columnEl.querySelectorAll('.kanban-card:not([style*="display: none"])');
                    countEl.textContent = visibleCards.length;
                }
            });
        }

        // Drag and drop functionality
        function initializeDragAndDrop() {
            console.log(' Initializing drag and drop...');

            // Remove existing event listeners first to avoid duplicates
            const existingCards = document.querySelectorAll('.kanban-card');
            const existingColumns = document.querySelectorAll('.kanban-cards');

            console.log(`Found ${existingCards.length} existing cards and ${existingColumns.length} existing columns`);

            existingCards.forEach((card, index) => {
                card.removeEventListener('dragstart', handleDragStart);
                card.removeEventListener('dragend', handleDragEnd);
                console.log(`Removed listeners from card ${index}`);
            });

            existingColumns.forEach((column, index) => {
                column.removeEventListener('dragover', handleDragOver);
                column.removeEventListener('drop', handleDrop);
                column.removeEventListener('dragleave', handleDragLeave);
                console.log(`Removed listeners from column ${index} (${column.id})`);
            });

            // Add fresh event listeners
            const kanbanCards = document.querySelectorAll('.kanban-card');
            const kanbanColumns = document.querySelectorAll('.kanban-cards');

            console.log(`Adding listeners to ${kanbanCards.length} cards and ${kanbanColumns.length} columns`);

            kanbanCards.forEach((card, index) => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                card.addEventListener('mousedown', () => console.log(`Mouse down on card ${index}`));
                console.log(`Added listeners to card ${index} (task: ${card.dataset.taskId})`);
            });

            kanbanColumns.forEach((column, index) => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
                column.addEventListener('dragleave', handleDragLeave);
                console.log(`Added listeners to column ${index} (${column.id})`);
            });

            console.log(' Drag and drop initialization complete!');
        }

        function handleDragStart(e) {
            console.log(' Drag started on:', e.target.dataset.taskId);
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.taskId);
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            console.log(' Drag ended');
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            console.log(' Drag over:', e.currentTarget.id);
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            console.log(' Drag leave:', e.currentTarget.id);
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            console.log(' Drop event fired on:', e.currentTarget.id);
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');

            const taskId = e.dataTransfer.getData('text/plain');
            console.log(' Task ID from dataTransfer:', taskId);

            const draggedElement = document.querySelector(`[data-task-id="${taskId}"]`);
            console.log(' Found dragged element:', draggedElement);

            if (draggedElement && e.currentTarget) {
                console.log(' Moving element to new column');
                e.currentTarget.appendChild(draggedElement);
                updateKanbanCounts();

                // Update task status via API
                const newStatus = getStatusFromColumn(e.currentTarget.id);
                console.log(` New status for task ${taskId}: ${newStatus}`);
                if (newStatus) {
                    updateTaskStatus(taskId, newStatus);
                }
            } else {
                console.error(' Could not find dragged element or target column', {
                    draggedElement: !!draggedElement,
                    currentTarget: !!e.currentTarget,
                    taskId: taskId
                });
            }
        }

        function getStatusFromColumn(columnId) {
            const statusMap = {
                'not-started-column': 'Not Started',
                'in-progress-column': 'In Progress',
                'completed-column': 'Completed',
                'on-hold-column': 'On Hold'
            };
            return statusMap[columnId];
        }

        function updateTaskStatus(taskId, newStatus) {
            fetch('/edit_task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ID: taskId, Status: newStatus })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showNotification('Task status updated successfully!', 'success');
                    // Reinitialize drag and drop after status update
                    setTimeout(() => initializeDragAndDrop(), 100);
                } else {
                    showNotification('Failed to update task status', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Failed to update task status', 'error');
            });
        }

        // Enhanced notification system
        let notificationCounter = 0;
        function showNotification(message, type = 'info', duration = 4000) {
            notificationCounter++;
            const notificationId = `notification-${notificationCounter}`;

            const notification = document.createElement('div');
            notification.id = notificationId;
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} alert-dismissible fade show position-fixed shadow`;
            notification.style.cssText = `
                top: ${20 + (notificationCounter - 1) * 70}px;
                right: 20px;
                z-index: 9999;
                min-width: 320px;
                max-width: 400px;
                border: none;
                border-radius: var(--radius-lg);
                backdrop-filter: blur(10px);
                animation: slideInRight 0.3s ease-out;
            `;

            const icon = type === 'success' ? 'check-circle' :
                        type === 'error' ? 'exclamation-triangle' :
                        type === 'warning' ? 'exclamation-circle' : 'info-circle';

            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${icon} me-2"></i>
                    <div class="flex-grow-1">${message}</div>
                    <button type="button" class="btn-close btn-close-white opacity-75" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;

            document.body.appendChild(notification);

            // Auto remove after duration
            setTimeout(() => {
                if (document.getElementById(notificationId)) {
                    notification.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => notification.remove(), 300);
                }
            }, duration);

            // Update positions of other notifications
            setTimeout(() => {
                updateNotificationPositions();
            }, 100);
        }

        function updateNotificationPositions() {
            const notifications = document.querySelectorAll('[id^="notification-"]');
            notifications.forEach((notif, index) => {
                notif.style.top = `${20 + index * 70}px`;
            });
        }

        // Task management functions
        function editTask(taskId) {
    fetch('/get_task/' + taskId)
                .then(response => response.json())
      .then(task => {
        const form = document.getElementById('editTaskForm');
                    // Clear form first
                    form.reset();

                    // Populate form fields
        for (const key in task) {
          const field = form[key];
                        if (field) {
          if (field.tagName === 'SELECT') {
            Array.from(field.options).forEach(opt => {
              opt.selected = opt.value === task[key];
            });
          } else {
                                field.value = task[key] || '';
          }
        }
                    }

                    // Show modal
        const modal = new bootstrap.Modal(document.getElementById('editTaskModal'));
        modal.show();
                })
                .catch(error => {
                    console.error('Error loading task:', error);
                    showNotification('Failed to load task details', 'error');
                });
        }

        function viewTask(taskId) {
            fetch('/get_task/' + taskId)
                .then(response => response.json())
                .then(task => {
                    const content = document.getElementById('taskDetailsContent');
                    content.innerHTML = `
                        <!-- x.ai Modern Task Details -->
                        <div class="modern-task-details">
                            <!-- Header Section -->
                            <div class="task-header-section">
                                <div class="task-header-content">
                                    <!-- Task Type Icon -->
                                    <div class="task-type-icon">
                                        <div class="icon-circle">
                                            <i class="fas ${getTaskTypeIcon(task.Type)}"></i>
                                        </div>
                                    </div>

                                    <!-- Main Info - All on one line -->
                                    <div class="task-main-info">
                                        <div class="task-info-row">
                                            <h1 class="task-title">${task.Description}</h1>
                                            <div class="task-details-compact">
                                                <span class="task-id-compact">${task.ID}</span>
                                                <span class="badge-modern type">${task.Type}</span>
                                                ${task.Product ? `<span class="badge-modern product">${task.Product}</span>` : ''}
                                                ${task.Module ? `<span class="badge-modern module">${task.Module}</span>` : ''}
                                                ${task.Requester ? `<span class="badge-modern requester">${task.Requester}</span>` : ''}
                                                ${task['Business Unit'] ? `<span class="badge-modern business-unit">${task['Business Unit']}</span>` : ''}

                                                <!-- Status & Priority inline -->
                                                <div class="status-priority-inline">
                                                    <div class="status-dot status-${task.Status.toLowerCase().replace(' ', '-')}"></div>
                                                    <span class="status-text-compact">${task.Status}</span>
                                                    <span class="priority-separator"></span>
                                                    <div class="priority-dot priority-${task.Priority.toLowerCase()}"></div>
                                                    <span class="priority-text-compact">${task.Priority}</span>
                                                </div>

                                                <!-- Timeline info inline -->
                                                <div class="timeline-inline">
                                                    ${task['Created Date'] ? `<span class="timeline-item-inline">
                                                        <i class="fas fa-calendar-plus"></i> ${task['Created Date']}
                                                    </span>` : ''}
                                                    ${task['Due Date'] ? `<span class="timeline-item-inline due-date">
                                                        <i class="fas fa-calendar-check"></i> ${task['Due Date']}
                                                    </span>` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!-- Action Plan Section -->
                            <div class="action-plan-section">
                                <div class="section-header">
                                    <div class="section-title">
                                        <i class="fas fa-tasks"></i>
                                        Action Plan
                                    </div>
                                    <button type="button" class="standup-btn" onclick="standupUpdateActionPlan('${task.ID}')" title="Standup Update: Move current plan to history and add new plan">
                                        <i class="fas fa-sync-alt"></i>
                                        Standup Update
                                    </button>
                                </div>

                                ${task['Current Action Plan'] ? `
                                <div class="current-plan">
                                    <div class="plan-header">
                                        <div class="plan-status active">
                                            <div class="status-indicator"></div>
                                            <span>Current Plan</span>
                                        </div>
                                    </div>
                                    <div class="plan-content">
                                        ${task['Current Action Plan']}
                                    </div>
                                </div>` : '<div class="no-plan">No current action plan available</div>'}

                                ${task['Action Plan History'] ? `
                                <div class="plan-history">
                                    <div class="plan-header">
                                        <div class="plan-status history">
                                            <i class="fas fa-history"></i>
                                            <span>Plan History</span>
                                        </div>
                                    </div>
                                    <div class="plan-content history">
                                        <pre>${task['Action Plan History']}</pre>
                                    </div>
                                </div>` : ''}
                            </div>
                        </div>
                    `;

                    // Helper function for task type icons
                    function getTaskTypeIcon(type) {
                        const icons = {
                            'Bug': 'fa-bug',
                            'Feature': 'fa-lightbulb',
                            'Task': 'fa-check-square',
                            'Enhancement': 'fa-arrow-up',
                            'Documentation': 'fa-book',
                            'Research': 'fa-search',
                            'Maintenance': 'fa-tools'
                        };
                        return icons[type] || 'fa-tasks';
                    }

                    // Show modal
                    const modal = new bootstrap.Modal(document.getElementById('viewTaskModal'));
                    modal.show();
                })
                .catch(error => {
                    console.error('Error loading task:', error);
                    showNotification('Failed to load task details', 'error');
                });
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task? This action cannot be undone.')) {
                fetch('/delete_task', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: taskId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('Task deleted successfully!', 'success');
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        showNotification('Failed to delete task', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Failed to delete task', 'error');
                });
            }
        }

        // Add task function
        function submitAddTask() {
            const form = document.getElementById('addTaskForm');
            const formData = new FormData(form);
            const taskData = Object.fromEntries(formData.entries());

            // Validate required fields
            if (!taskData.Type || !taskData.Product || !taskData.Module || !taskData.Description || !taskData.Status || !taskData.Priority) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            fetch('/add_task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(taskData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showNotification('Task added successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addTaskModal')).hide();
                    form.reset();
                    setTimeout(() => location.reload(), 1000);
                } else {
                    showNotification('Failed to add task: ' + (data.message || 'Unknown error'), 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Failed to add task', 'error');
            });
        }

        // Edit task function
        function submitEditTask() {
  const form = document.getElementById('editTaskForm');
  const formData = new FormData(form);
            const taskData = Object.fromEntries(formData.entries());

            // Validate required fields
            if (!taskData.Type || !taskData.Product || !taskData.Module || !taskData.Description || !taskData.Status || !taskData.Priority) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

  fetch('/edit_task', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(taskData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showNotification('Task updated successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('editTaskModal')).hide();
                    setTimeout(() => location.reload(), 1000);
    } else {
                    showNotification('Failed to update task: ' + (data.message || 'Unknown error'), 'error');
    }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Failed to update task', 'error');
  });
}

        // Export tasks function
        function exportTasks() {
            // Show loading state
            const exportBtn = event.target;
            const originalText = exportBtn.innerHTML;
            exportBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Exporting...';
            exportBtn.disabled = true;

            fetch('/export_csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Export failed');
                    }
                    return response.blob();
                })
                .then(blob => {
                    // Create download link
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'tasks_export.csv';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);

                    showNotification('Tasks exported successfully!', 'success');

                    // Close modal
                    bootstrap.Modal.getInstance(document.getElementById('importExportModal')).hide();
                })
                .catch(error => {
                    console.error('Export error:', error);
                    showNotification('Failed to export tasks. Please try again.', 'error');
                })
                .finally(() => {
                    // Reset button state
                    exportBtn.innerHTML = originalText;
                    exportBtn.disabled = false;
                });
        }

        // Import tasks function
        function importTasks() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];

            if (!file) {
                showNotification('Please select a CSV file to import.', 'warning');
                return;
            }

            if (!file.name.toLowerCase().endsWith('.csv')) {
                showNotification('Please select a valid CSV file.', 'error');
                return;
            }

            // Show loading state
            const importBtn = event.target;
            const originalText = importBtn.innerHTML;
            importBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Importing...';
            importBtn.disabled = true;

            // Create FormData for file upload
            const formData = new FormData();
            formData.append('file', file);

            fetch('/import_csv', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('Tasks imported successfully!', 'success');
                        // Close modal and reload page
                        bootstrap.Modal.getInstance(document.getElementById('importExportModal')).hide();
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showNotification('Import failed: ' + (data.message || 'Unknown error'), 'error');
                    }
                })
                .catch(error => {
                    console.error('Import error:', error);
                    showNotification('Failed to import tasks. Please check your CSV file format.', 'error');
                })
                .finally(() => {
                    // Reset button state
                    importBtn.innerHTML = originalText;
                    importBtn.disabled = false;
                    // Clear file input
                    fileInput.value = '';
                });
        }

        // Quick Add functionality
        function initializeQuickAdd() {
            console.log(' Initializing Quick Add...');

            // Add a small delay to ensure DOM is ready
            setTimeout(() => {
                const quickAddBtn = document.getElementById('quickAddBtn');
                const quickAddContainer = document.getElementById('quickAddContainer');
                const quickAddInput = document.getElementById('quickAddInput');
                const quickAddSubmit = document.getElementById('quickAddSubmit');
                const quickAddCancel = document.getElementById('quickAddCancel');

                console.log('Quick Add elements after delay:', {
                    quickAddBtn: !!quickAddBtn,
                    quickAddContainer: !!quickAddContainer,
                    quickAddInput: !!quickAddInput,
                    quickAddSubmit: !!quickAddSubmit,
                    quickAddCancel: !!quickAddCancel
                });

                if (quickAddBtn) {
                    console.log('Quick Add button found:', quickAddBtn);
                    console.log('Button classes:', quickAddBtn.className);
                    console.log('Button style:', quickAddBtn.style.cssText);
                }

                if (!quickAddBtn || !quickAddContainer || !quickAddInput) {
                    console.warn('Quick Add initialization failed - missing elements');
                    return;
                }

                console.log('Quick Add initialized successfully');

                // Toggle Quick Add
                quickAddBtn.addEventListener('click', function(e) {
                    console.log('Quick Add button clicked');
                    console.log('Button element:', quickAddBtn);
                    console.log('Container element:', quickAddContainer);
                    const isVisible = quickAddContainer.style.display !== 'none';
                    console.log('Quick Add container visible:', isVisible);
                    if (isVisible) {
                        hideQuickAdd();
                    } else {
                        showQuickAdd();
                    }
                });

                // Define functions that need the DOM elements
                function submitQuickAdd() {
                    const description = quickAddInput.value.trim();
                    if (!description) {
                        showNotification('Please enter a task description.', 'warning');
                        quickAddInput.focus();
                        return;
                    }

                    // Create task data for quick add
                    const taskData = {
                        Type: 'Task', // Default type
                        Category: 'General', // Default category
                        Description: description,
                        Status: 'Not Started',
                        Priority: 'Medium', // Default priority
                        'Created Date': new Date().toISOString().split('T')[0],
                        'Due Date': '',
                        'Status Update Date': new Date().toISOString().split('T')[0],
                        'Current Action Plan': description,
                        'Action Plan History': ''
                    };

                    console.log('Submitting Quick Add task:', taskData);

                    // Show loading state
                    quickAddSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                    quickAddSubmit.disabled = true;
                    quickAddInput.disabled = true;

                    fetch('/add_task', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(taskData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Quick Add response:', data);
                        if (data.status === 'success') {
                            showNotification('Task added successfully!', 'success');
                            hideQuickAdd();
                            setTimeout(() => location.reload(), 1000);
                        } else {
                            showNotification('Failed to add task: ' + (data.message || 'Unknown error'), 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Quick Add error:', error);
                        showNotification('Failed to add task. Please try again.', 'error');
                    })
                    .finally(() => {
                        // Reset button state
                        quickAddSubmit.innerHTML = '<i class="fas fa-plus"></i>';
                        quickAddSubmit.disabled = false;
                        quickAddInput.disabled = false;
                    });
                }

                function showQuickAdd() {
                    quickAddContainer.style.display = 'block';
                    quickAddInput.focus();
                    quickAddInput.value = '';
                }

                function hideQuickAdd() {
                    quickAddContainer.style.display = 'none';
                    quickAddInput.value = '';
                }

                // Attach event listeners
                quickAddSubmit.addEventListener('click', submitQuickAdd);
                quickAddCancel.addEventListener('click', hideQuickAdd);

                quickAddInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        submitQuickAdd();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        hideQuickAdd();
                    }
                });

                // Click outside to hide
                document.addEventListener('click', function(e) {
                    if (!quickAddContainer.contains(e.target) && e.target !== quickAddBtn) {
                        hideQuickAdd();
                    }
                });

            }, 100); // 100ms delay to ensure DOM is ready
        }




        // Saved Filters functionality
        function initializeSavedFilters() {
            const saveCurrentFilterBtn = document.getElementById('saveCurrentFilterBtn');
            const savedFiltersList = document.getElementById('savedFiltersList');

            if (!saveCurrentFilterBtn || !savedFiltersList) return;

            // Load saved filters from localStorage
            loadSavedFilters();

            // Save current filter button
            saveCurrentFilterBtn.addEventListener('click', function() {
                saveCurrentFilter();
            });
        }

        function saveCurrentFilter() {
            const statusFilter = document.getElementById('statusFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const typeFilter = document.getElementById('typeFilter');
            const searchInput = document.getElementById('searchInput');

            const filterName = prompt('Enter a name for this filter:');
            if (!filterName || filterName.trim() === '') {
                showNotification('Filter name is required.', 'warning');
                return;
            }

            const currentFilter = {
                name: filterName.trim(),
                status: statusFilter.value,
                priority: priorityFilter.value,
                type: typeFilter.value,
                search: searchInput.value,
                createdAt: new Date().toISOString()
            };

            // Get existing saved filters
            let savedFilters = JSON.parse(localStorage.getItem('savedFilters') || '[]');

            // Check if filter with same name exists
            const existingIndex = savedFilters.findIndex(f => f.name === currentFilter.name);
            if (existingIndex !== -1) {
                if (!confirm(`A filter named "${currentFilter.name}" already exists. Replace it?`)) {
                    return;
                }
                savedFilters[existingIndex] = currentFilter;
            } else {
                savedFilters.push(currentFilter);
            }

            // Save to localStorage
            localStorage.setItem('savedFilters', JSON.stringify(savedFilters));

            // Reload saved filters display
            loadSavedFilters();

            showNotification(`Filter "${currentFilter.name}" saved successfully!`, 'success');
        }

        function loadSavedFilters() {
            const savedFiltersList = document.getElementById('savedFiltersList');
            const savedFilters = JSON.parse(localStorage.getItem('savedFilters') || '[]');

            savedFiltersList.innerHTML = '';

            if (savedFilters.length === 0) {
                savedFiltersList.innerHTML = '<div class="text-muted small">No saved filters yet. Save your current filter to get started.</div>';
                return;
            }

            savedFilters.forEach((filter, index) => {
                const filterItem = document.createElement('div');
                filterItem.className = 'saved-filter-item';
                filterItem.innerHTML = `
                    <span class="saved-filter-name">${filter.name}</span>
                    <button class="saved-filter-delete" onclick="deleteSavedFilter(${index}, '${filter.name}')" title="Delete filter">
                        <i class="fas fa-times"></i>
                    </button>
                `;

                // Add click handler to load the filter
                filterItem.addEventListener('click', function(e) {
                    // Don't trigger if delete button was clicked
                    if (e.target.closest('.saved-filter-delete')) return;

                    loadSavedFilter(filter);
                });

                savedFiltersList.appendChild(filterItem);
            });
        }

        function loadSavedFilter(filter) {
            const statusFilter = document.getElementById('statusFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const typeFilter = document.getElementById('typeFilter');
            const searchInput = document.getElementById('searchInput');

            // Set filter values
            statusFilter.value = filter.status || '';
            priorityFilter.value = filter.priority || '';
            typeFilter.value = filter.type || '';
            searchInput.value = filter.search || '';

            // Apply filters
            applyFilters();

            showNotification(`Filter "${filter.name}" loaded!`, 'success');

            // Highlight the active filter
            document.querySelectorAll('.saved-filter-item').forEach(item => {
                item.classList.remove('active');
            });

            // Find and highlight the current filter item
            const filterItems = document.querySelectorAll('.saved-filter-item');
            filterItems.forEach(item => {
                if (item.querySelector('.saved-filter-name').textContent === filter.name) {
                    item.classList.add('active');
                }
            });
        }

        function deleteSavedFilter(index, filterName) {
            if (!confirm(`Are you sure you want to delete the filter "${filterName}"?`)) {
                return;
            }

            let savedFilters = JSON.parse(localStorage.getItem('savedFilters') || '[]');
            savedFilters.splice(index, 1);

            localStorage.setItem('savedFilters', JSON.stringify(savedFilters));
            loadSavedFilters();

            showNotification(`Filter "${filterName}" deleted.`, 'info');
        }

        // Filter Drawer functionality
        function initializeFilterDrawer() {
            console.log(' Initializing Filter Drawer...');

            // Add a small delay to ensure DOM is ready
            setTimeout(() => {
                const filterToggleBtn = document.getElementById('filterToggleBtn');
                const closeFilterDrawer = document.getElementById('closeFilterDrawer');
                const filterDrawer = document.getElementById('filterDrawer');
                const filterOverlay = document.getElementById('filterOverlay');

                console.log('Filter Drawer elements after delay:', {
                    filterToggleBtn: !!filterToggleBtn,
                    closeFilterDrawer: !!closeFilterDrawer,
                    filterDrawer: !!filterDrawer,
                    filterOverlay: !!filterOverlay
                });

                if (!filterToggleBtn || !filterDrawer) {
                    console.warn('Filter Drawer initialization failed - missing elements');
                    return;
                }

                console.log('Filter Drawer initialized successfully');

                // Toggle filter drawer
                filterToggleBtn.addEventListener('click', function() {
                    console.log('Filter toggle button clicked');
                    toggleFilterDrawer();
                });

                // Define functions that need the DOM elements
                function toggleFilterDrawer() {
                    const isOpen = filterDrawer.classList.contains('open');

                    if (isOpen) {
                        closeFilterDrawerFunc();
                    } else {
                        openFilterDrawer();
                    }
                }

                function openFilterDrawer() {
                    filterDrawer.style.display = 'block';
                    setTimeout(() => {
                        filterDrawer.classList.add('open');
                        filterOverlay.style.display = 'block';
                        setTimeout(() => {
                            filterOverlay.classList.add('active');
                        }, 10);
                    }, 10);
                    document.body.style.overflow = 'hidden';
                }

                function closeFilterDrawerFunc() {
                    filterDrawer.classList.remove('open');
                    filterOverlay.classList.remove('active');
                    setTimeout(() => {
                        filterOverlay.style.display = 'none';
                        filterDrawer.style.display = 'none';
                    }, 300);
                    document.body.style.overflow = '';
                }

                // Close filter drawer
                closeFilterDrawer.addEventListener('click', function() {
                    closeFilterDrawerFunc();
                });

                // Close on overlay click
                filterOverlay.addEventListener('click', function() {
                    closeFilterDrawerFunc();
                });

                // Close on Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && filterDrawer.classList.contains('open')) {
                        closeFilterDrawerFunc();
                    }
                });

            }, 100); // 100ms delay to ensure DOM is ready
        }

        // Standup Action Plan Update Function
        function standupUpdateActionPlan(taskId) {
            const newPlan = prompt('Enter your new action plan for standup:');
            if (newPlan === null || newPlan.trim() === '') {
                return; // User cancelled or entered empty plan
            }

            if (confirm('This will move your current action plan to history and set the new plan as current. Continue?')) {
                fetch('/standup_update_action_plan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: taskId,
                        new_action_plan: newPlan.trim()
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        showNotification('Action plan updated for standup successfully!', 'success');
                        // Refresh the task details modal if it's open
                        if (document.getElementById('viewTaskModal').classList.contains('show')) {
                            // Find the current task ID from the modal
                            const currentTaskId = document.querySelector('#viewTaskModal [data-task-id]')?.getAttribute('data-task-id') || taskId;
                            viewTask(currentTaskId);
                        }
                        // Optionally reload the page to show updated data
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        showNotification('Failed to update action plan for standup', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Failed to update action plan for standup', 'error');
                });
            }
        }
    </script></body>
</html>
